!function(t,r){"use strict";t.Cookies||console.error("WooCommerce Cookies Jar is not available.");var i=(Object.defineProperty(e.prototype,"STORAGE_KEY",{value:"zooWishlistItems",writable:!1,enumerable:!1,configurable:!1}),e.prototype.add=function(t){var i=this.list();if(t=parseInt(t,10),-1!==i.indexOf(t))return!1;i.push(t);var e=JSON.stringify(i);return window.localStorage.setItem(this.STORAGE_KEY,e),Cookies.remove(this.STORAGE_KEY),Cookies.set(this.STORAGE_KEY,e),!0},e.prototype.exists=function(t){return-1!==this.list().indexOf(parseInt(t,10))},e.prototype.remove=function(t){var i=parseInt(t,10),e=this.list(),o=e.indexOf(i);if(-1===o)return!1;e.splice(o,1);var s=JSON.stringify(e);return window.localStorage.setItem(this.STORAGE_KEY,s),Cookies.remove(this.STORAGE_KEY),Cookies.set(this.STORAGE_KEY,s),!0},e.prototype.list=function(){return JSON.parse(window.localStorage.getItem(this.STORAGE_KEY))},e.prototype.clear=function(){window.localStorage.setItem(this.STORAGE_KEY,"[]"),Cookies.remove(this.STORAGE_KEY)},e);function e(){null===window.localStorage.getItem(this.STORAGE_KEY)&&window.localStorage.setItem(this.STORAGE_KEY,"[]")}var o=(s.prototype.renderPanel=function(t){t=t||"<p>"+zooWishlistCDATA.wishlistIsEmpty+"</p>",this.panel.length?this.panel.find(".wishlist-panel-inner").html(t):r("body").append('<div class="wishlist-panel popup-panel" style="display:none"><div class="loading popup-mask-close"></div><button class="wishlist-panel-close-btn popup-close-btn" type="button" name="close-button"><i class="icon-close"></i> </button><div class="wishlist-panel-inner popup-inner" style="display: none">'+t+"</div></div></div>")},s.prototype.renderAddButton=function(t){t.hasClass("browse-wishlist")&&t.removeClass("browse-wishlist"),t.hasClass("add-to-wishlist")||t.addClass("add-to-wishlist"),t.attr("title",zooWishlistCDATA.addToWishlist),t.html(zooWishlistCDATA.addToWishlistIcon+zooWishlistCDATA.addToWishlist)},s.prototype.renderBrowseButton=function(t){if(!t instanceof jQuery||!t.attr("data-id"))throw new TypeError("Invalid wishlist button. Product ID not found.");(t=r(document).find(".wishlist-button[data-id="+t.attr("data-id")+"]")).removeClass("add-to-wishlist"),t.not(".browse-wishlist").addClass("browse-wishlist"),t.attr("title",zooWishlistCDATA.browseWishlist),t.html(zooWishlistCDATA.browseWishlistIcon+zooWishlistCDATA.browseWishlist)},s);function s(){this.panel=r(".wishlist-panel"),this.counter=r(".cafe-wlcp-counter"),this.addBtn=".add-to-wishlist",this.removeBtn=".remove-from-wishlist",this.browseBtn=".browse-wishlist:not(.redirect-link)",this.panel.length||(this.renderPanel(),this.panel=r(".wishlist-panel"))}var n=(a.prototype.sync=function(t){var i;"zooWishlistItems"===t.key&&(i=JSON.parse(window.localStorage.getItem("zooWishlistItems")),r(".wishlist-counter").text(i.length),i.length<1&&r(".wishlist-counter").addClass("hidden"))},a.prototype.maybeFetchVariationId=function(){var s=this,n=r('input[name="variation_id"]');n.length&&n.on("change",function(t){var i=s.model.list(),e=parseInt(n.val()),o=r(this).parent().find(".wishlist-button");e&&(o.attr("data-id",e),-1!==i.indexOf(e)?s.view.renderBrowseButton(o):o.hasClass(s.view.addBtn)||s.view.renderAddButton(o))})},a.prototype.updateAddButtonsActions=function(){var e=this,o=this.model.list();r("body").hasClass("single-product")&&e.maybeFetchVariationId(),r(".add-to-wishlist").each(function(t){var i;!this instanceof HTMLElement||(i=parseInt(r(this).attr("data-id")),-1!==o.indexOf(i)&&e.view.renderBrowseButton(r(this)))})},a.prototype.addAction=function(t){var i=r(t.currentTarget),e=i.attr("data-id");if(!i.hasClass("browse-wishlist")||!i.hasClass("redirect-link")){if(t.preventDefault(),i.hasClass("browse-wishlist"))return this.browseAction(t);if(this.model.exists(e))this.view.renderBrowseButton(i);else if(this.model.add(e)){if(this.view.renderBrowseButton(i),this.view.counter.removeClass("hidden"),this.view.counter.text(this.model.list().length),!i.hasClass("redirect-link"))return this.browseAction(t);r(document).find(".product-popup-notice")[0]?r(document).find(".product-popup-notice").addClass("active"):(r("body").append('<div class="product-popup-notice">'+i.data("label-added")+"</div>"),setTimeout(function(){r(document).find(".product-popup-notice").addClass("active")},100)),setTimeout(function(){r(document).find(".product-popup-notice").removeClass("active")},1200)}else alert(zooWishlistCDATA.addToWishlistErr)}},a.prototype.removeAction=function(t){t.preventDefault();var i,e=r(t.currentTarget).attr("data-id"),o=r('.wishlist-button[data-id="'+e+'"]'),s=this.model.remove(e);o.length&&this.view.renderAddButton(o),s&&((i=this.model.list().length)?this.view.panel.find("#wishlist-item-row-"+e).remove():this.view.renderPanel("<p>"+zooWishlistCDATA.wishlistIsEmpty+"</p>"),this.view.counter.text(i),i<1&&this.view.counter.addClass("hidden"))},a.prototype.browseAction=function(t){t.preventDefault();var i=this,e=this.model.list();i.view.panel.fadeIn(),e.length&&!this.doingAJAX?(this.doingAJAX=!0,r.ajax({method:"POST",url:ajaxurl,data:{action:"sublimeplus_get_wishlist_products",wishlistItems:JSON.stringify(e)}}).done(function(t){i.doingAJAX=!1,i.view.renderPanel(t.html),i.view.removeBtn=".remove-from-wishlist",r(document).on("click",i.view.removeBtn,function(t){i.removeAction(t)}),i.view.panel.find(".wishlist-panel-inner").fadeIn()})):i.view.panel.find(".wishlist-panel-inner").fadeIn(),r(document).trigger("sublimeplus_browse_wishlist")},a.prototype.listen=function(){var i=this;r(document).on("click",this.view.addBtn,function(t){i.addAction(t)}),r(this.view.removeBtn).length&&r(document).on("click",this.view.removeBtn,function(t){i.removeAction(t)}),r(document).on("click",this.view.browseBtn,function(t){i.browseAction(t)}),this.view.panel.find(".wishlist-panel-close-btn").on("click",function(t){i.view.panel.fadeOut()}),this.view.panel.find(".popup-mask-close").on("click",function(t){i.view.panel.fadeOut()}),window.addEventListener("storage",this.sync)},a);function a(t,i){this.view=i,this.model=t,this.doingAJAX=!1;var e=this.model.list().length;this.view.counter.text(e),e<1?this.view.counter.addClass("hidden"):this.view.counter.removeClass("hidden"),this.updateAddButtonsActions(),this.listen()}r(document).ready(function(){t.zooWishlist=new n(new i,new o)})}(window,jQuery);